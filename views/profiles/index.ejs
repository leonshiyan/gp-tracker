<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<main>
  <div class="grid container-md gap-3 ">
    <div class="container text-center ">
      <div class="row">
        <div class="col">
          <span class="fs-5">Hello, <%= user?user.profile.name : "Guest" %></span>
          <div class="card" style="width: 100%;">
            <img src="<%= user.profile.avatar %> " class="card-img-top" alt="Avatar">
            <div class="card-body">
              <p class="card-text">
                <a href="/transactions/new" class="btn btn-primary">Add Transaction</a>
              </p>
            </div>
          </div>
        </div>
        <div class="col-8 ">
          <h2>Your Transactions</h2>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Transaction Time</th>
                <th scope="col">Unit Price</th>
                <th scope="col">Transaction Link</th>
              </tr>
            </thead>
            <tbody>
              <% myProfile.transactions.sort(function(a,b){ return b.createdAt - a.createdAt}) %> 
              <% myProfile.transactions.forEach(transaction => { %>
                <tr>
                  <th class="align-middle" scope="row">
                    <%= transaction.createdAt.toLocaleString() %> 
                  </th>
                  <td class="align-middle">
                    <%= (transaction.amount/transaction.gasAmount).toFixed(2) %>
                  </td>
                  <td class="align-middle">
                    <button type="button" class="btn btn-primary btn-lg" onclick="window.location.href='/transactions/<%= transaction._id %>'">Here</button>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
        <div class="col">
          <span class="fs-5">Active Users</span>
          <ul class="list-group">
            <% profiles.forEach(profile => { %>
              <li class="list-group-item">
                <%= profile.name.split(" ")[0] + " " + "*".repeat(profile.name.split(" ")[1].length) %>
              </li>
            <% }) %>
          </ul>
        </div>
      </div>
    </div>
</div>
</main>

<%- include('../partials/footer') %>
